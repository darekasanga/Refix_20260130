<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EnCho-ãƒãƒ‹ãƒ¥ã‚¢ãƒ«-</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />
  <script src="theme.js"></script>
  <script>
    window.EnchoTheme?.applyCurrentTheme(document);
  </script>
  <style>
    :root {
      --accent: #8b5cf6;
      --accent-2: #f59e0b;
      --accent-3: #22d3ee;
      --accent-4: #fb7185;
      --muted: #6b6477;
      --panel: #ffffff;
      --panel-sub: #fdf7ff;
      --border: #e7dff2;
      --text: #1f1b2d;
      --subtext: #6b6477;
      --bg: radial-gradient(circle at 18% 20%, rgba(255,221,235,.8), transparent 40%),
        radial-gradient(circle at 80% 8%, rgba(189,227,255,.7), transparent 34%),
        linear-gradient(180deg,#fff8fd,#f5f7ff);
      --panel-overlay: rgba(255,255,255,.92);
      --panel-2: var(--panel-sub);
      --glow: 0 12px 45px rgba(139, 92, 246, 0.24);
      --page-zoom: 1;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Noto Sans JP", "Hiragino Sans", "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.7;
    }
    body.is-editor-locked {
      overflow: hidden;
    }
    .page-header {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 14px 12px;
      background: var(--panel-overlay);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      font-size: 0.75rem;
    }
    .page-header__inner {
      max-width: 980px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
    }
    .page-header__title {
      margin: 0 0 8px;
      font-size: 22px;
      letter-spacing: 0.04em;
    }
    .page-header__desc {
      margin: 0;
      max-width: 720px;
      color: var(--muted);
    }
    .page-header__meta {
      display: grid;
      gap: 4px;
      margin-top: 10px;
      font-size: 14px;
      color: var(--subtext);
    }
    .page-header__meta strong {
      color: var(--text);
      font-weight: 700;
    }
    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .header-version {
      display: inline-flex;
      align-items: baseline;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--panel);
      font-size: 11px;
      color: var(--subtext);
      box-shadow: var(--glow);
    }
    .header-version strong {
      color: var(--text);
      font-weight: 700;
    }
    .edit-toggle {
      font: inherit;
      color: var(--text);
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(34, 211, 238, 0.2));
      border: 1px solid rgba(139, 92, 246, 0.4);
      border-radius: 999px;
      padding: 4px 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 11px;
      letter-spacing: 0.02em;
    }
    .edit-toggle.is-active {
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.4);
    }
    .confirm-button {
      font: inherit;
      color: #1f1b2d;
      background: var(--accent);
      border: none;
      border-radius: 999px;
      padding: 4px 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 11px;
      letter-spacing: 0.02em;
      box-shadow: 0 10px 20px rgba(139, 92, 246, 0.35);
    }
    .confirm-button.is-locked {
      background: var(--accent-2);
      color: #2b1c15;
    }
    .refresh-button {
      font: inherit;
      color: var(--text);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 4px 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 11px;
      letter-spacing: 0.02em;
    }
    .header-zoom {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--panel);
      font-size: 11px;
      color: var(--subtext);
      box-shadow: var(--glow);
    }
    .header-zoom__button {
      font: inherit;
      border: 1px solid var(--border);
      background: var(--panel-2);
      color: var(--text);
      border-radius: 999px;
      padding: 1px 6px;
      cursor: pointer;
      font-weight: 700;
    }
    .header-zoom input[type="range"] {
      width: 120px;
      accent-color: var(--accent);
    }
    .header-zoom strong {
      color: var(--text);
      font-weight: 700;
      min-width: 38px;
      text-align: right;
    }
    .page-zoom {
      zoom: var(--page-zoom);
    }
    main {
      max-width: 980px;
      margin: 0 auto 80px;
      padding: 0 16px;
      display: grid;
      gap: 20px;
    }
    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      box-shadow: var(--glow);
    }
    .toc {
      display: grid;
      gap: 10px;
      padding-left: 18px;
    }
    .toc a {
      color: var(--accent);
      text-decoration: none;
    }
    .toc a:hover { text-decoration: underline; }
    section h2 {
      margin-top: 0;
      font-size: 20px;
      color: var(--accent);
    }
    section h3 {
      margin-top: 18px;
      font-size: 16px;
      color: var(--accent-2);
    }
    ul {
      padding-left: 18px;
      margin: 10px 0;
    }
    .note {
      background: var(--panel-2);
      border: 1px dashed var(--border);
      padding: 12px 14px;
      border-radius: 12px;
      color: var(--subtext);
    }
    .steps {
      display: grid;
      gap: 8px;
      padding-left: 18px;
    }
    .editor-toolbar {
      position: fixed;
      right: 24px;
      bottom: 24px;
      z-index: 30;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      padding: 10px;
      border-radius: 16px;
      background: var(--panel-overlay);
      border: 1px solid var(--border);
      backdrop-filter: blur(12px);
      max-width: min(360px, calc(100vw - 32px));
      max-height: min(65vh, 460px);
      overflow: auto;
      box-shadow: var(--glow);
      font-size: 12px;
    }
    .editor-toolbar.is-locked {
      border-color: rgba(139, 92, 246, 0.6);
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2), var(--glow);
    }
    .editor-toolbar.is-hidden {
      display: none;
    }
    .editor-toolbar button,
    .editor-toolbar label,
    .editor-toolbar input[type="color"],
    .editor-toolbar select,
    .editor-toolbar input[type="number"],
    .editor-toolbar input[type="range"] {
      font: inherit;
      color: var(--text);
      background: var(--panel-2);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 5px 10px;
      cursor: pointer;
    }
    .editor-toolbar button:hover,
    .editor-toolbar label:hover {
      border-color: var(--accent);
    }
    .editor-toolbar input[type="file"] {
      display: none;
    }
    .editor-toolbar select,
    .editor-toolbar input[type="number"],
    .editor-toolbar input[type="range"] {
      padding: 5px 8px;
    }
    .editor-toolbar .hint {
      font-size: 11px;
      color: var(--subtext);
      padding: 0 8px;
    }
    .editor-toolbar .size-control {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid var(--border);
    }
    .editor-toolbar .size-control input[type="number"] {
      width: 62px;
      text-align: center;
    }
    .editor-toolbar__handle {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 4px 6px;
      border-radius: 12px;
      background: rgba(139, 92, 246, 0.12);
      color: var(--text);
      font-weight: 700;
      cursor: default;
      user-select: none;
    }
    .editor-toolbar__handle-actions {
      display: inline-flex;
      gap: 6px;
      align-items: center;
    }
    .editor-toolbar__handle-actions button {
      font: inherit;
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 2px 8px;
      background: var(--panel);
      color: var(--text);
      cursor: pointer;
      font-size: 11px;
      font-weight: 700;
    }
    .editor-toolbar__handle-actions button:hover {
      border-color: var(--accent);
    }
    .editor-toolbar__handle span {
      font-size: 11px;
      color: var(--subtext);
      font-weight: 600;
    }
    .editor-shell {
      position: relative;
    }
    .editor-shell.is-locked {
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.35), var(--glow);
      border-radius: 16px;
      z-index: 16;
    }
    .editor-shell.is-locked .panel {
      border-color: rgba(139, 92, 246, 0.4);
    }
    .editor-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.18);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 15;
    }
    .editor-backdrop.is-visible {
      opacity: 1;
      pointer-events: auto;
    }
    .editor {
      outline: none;
      max-height: calc(100vh - 240px);
      overflow: auto;
    }
    .image-block {
      display: inline-flex;
      flex-direction: column;
      gap: 6px;
      padding: 6px;
      border-radius: 12px;
      border: 2px solid transparent;
      --frame-color: #38bdf8;
      --image-width: 100%;
      width: var(--image-width);
      max-width: 100%;
      position: relative;
    }
    .image-block img {
      max-width: 100%;
      border-radius: 8px;
      display: block;
    }
    .image-overlay-layer {
      position: absolute;
      inset: 6px;
      pointer-events: none;
    }
    .image-overlay-item {
      position: absolute;
      top: 12px;
      left: 12px;
      pointer-events: auto;
      cursor: grab;
    }
    .image-overlay-item:active {
      cursor: grabbing;
    }
    .image-overlay-item.selected {
      box-shadow: 0 0 0 2px var(--accent);
    }
    .image-overlay-item.frame {
      border: 2px solid var(--accent);
      border-radius: 8px;
      width: 120px;
      height: 90px;
      background: rgba(15, 23, 42, 0.08);
    }
    .image-overlay-item.frame.circle {
      border-radius: 999px;
      width: 90px;
      height: 90px;
      border-color: var(--accent-2);
    }
    .image-overlay-text {
      padding: 4px 8px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.88);
      border: 1px solid var(--border);
      font-weight: 700;
      color: var(--text);
      white-space: pre-wrap;
    }
    .format-block {
      margin: 12px 0;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px dashed var(--border);
      background: var(--panel-sub);
      color: var(--text);
      font-size: 0.95rem;
      white-space: pre-wrap;
    }
    .image-block.frame {
      border-color: var(--frame-color);
    }
    .image-block.underline {
      border-bottom: 4px solid var(--frame-color);
    }
    .image-block.selected {
      box-shadow: 0 0 0 2px var(--accent);
    }
    .icon-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 26px;
      height: 26px;
      padding: 0 6px;
      border-radius: 999px;
      background: var(--accent);
      color: #1f1b2d;
      font-weight: 700;
      font-size: 12px;
    }
    .icon-badge.notice {
      background: #fbbf24;
      color: #111827;
    }
    .icon-badge.comment {
      background: #a78bfa;
      color: #1f1b2d;
    }
    .icon-badge.selected {
      box-shadow: 0 0 0 2px var(--accent);
    }
    .draft-banner {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 16px 20px;
      border-radius: 14px;
      background: rgba(245, 158, 11, 0.15);
      border: 1px solid rgba(245, 158, 11, 0.4);
      color: var(--text);
      box-shadow: var(--glow);
    }
    .draft-banner.is-hidden {
      display: none;
    }
    .draft-banner__text {
      display: grid;
      gap: 4px;
    }
    .draft-banner__meta {
      font-size: 12px;
      color: var(--subtext);
    }
    .draft-banner__actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .draft-banner__actions button {
      font: inherit;
      border-radius: 999px;
      padding: 6px 14px;
      cursor: pointer;
      border: 1px solid var(--border);
      background: var(--panel-2);
      color: var(--text);
      font-weight: 600;
    }
    .draft-banner__actions button.primary {
      background: var(--accent);
      color: #1f1b2d;
      border-color: rgba(56, 189, 248, 0.6);
    }
    .toast {
      position: fixed;
      right: 24px;
      bottom: 24px;
      background: var(--panel-overlay);
      color: var(--text);
      padding: 12px 18px;
      border-radius: 12px;
      box-shadow: var(--glow);
      border: 1px solid var(--border);
      opacity: 0;
      pointer-events: none;
      transform: translateY(10px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 40;
    }
    .toast.is-visible {
      opacity: 1;
      transform: translateY(0);
    }
    .page-footer {
      border-top: 1px solid var(--border);
      padding: 12px 16px 28px;
      color: var(--subtext);
      background: var(--panel-overlay);
      backdrop-filter: blur(12px);
    }
    .page-footer__inner {
      max-width: 980px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      font-size: 12px;
      flex-wrap: wrap;
    }
    .page-footer__status {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    .page-footer__status strong {
      color: var(--text);
      font-weight: 700;
    }
    .page-footer__note {
      color: var(--accent-2);
      font-weight: 700;
    }
    @media (max-width: 720px) {
      .page-header {
        padding: 12px 12px;
      }
      .page-header__title {
        font-size: 20px;
      }
      .header-actions {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
      }
      .editor-toolbar {
        right: 16px;
        left: 16px;
        bottom: 16px;
        max-width: calc(100vw - 32px);
      }
    }
  </style>
</head>
<body>
  <header class="page-header">
    <div class="page-header__inner">
      <div>
        <h1 class="page-header__title">EnCho-ãƒãƒ‹ãƒ¥ã‚¢ãƒ«-</h1>
      </div>
      <div class="header-actions">
        <div class="header-version" aria-live="polite">
          <span>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</span>
          <strong id="version-label">--</strong>
        </div>
        <label class="header-zoom">
          è¡¨ç¤º
          <button type="button" class="header-zoom__button" id="zoom-decrease">âˆ’</button>
          <input type="range" id="zoom-control" min="80" max="130" value="100" step="5" list="zoom-ticks" />
          <button type="button" class="header-zoom__button" id="zoom-increase">ï¼‹</button>
          <datalist id="zoom-ticks">
            <option value="80"></option>
            <option value="90"></option>
            <option value="100"></option>
            <option value="110"></option>
            <option value="120"></option>
            <option value="130"></option>
          </datalist>
          <strong id="zoom-label">100%</strong>
        </label>
        <button type="button" class="edit-toggle" id="toggle-editor-tools" aria-controls="editorToolbar" aria-expanded="false">ç·¨é›†</button>
        <button type="button" class="confirm-button" id="confirm-content">ç¢ºå®š</button>
        <button type="button" class="refresh-button" id="refresh-content">æ›´æ–°</button>
      </div>
    </div>
  </header>

  <div class="editor-backdrop" id="editor-backdrop" aria-hidden="true"></div>
  <div class="editor-toolbar is-hidden" id="editorToolbar" aria-hidden="true" contenteditable="false">
    <div class="editor-toolbar__handle" id="editor-toolbar-handle" contenteditable="false">
      <div class="editor-toolbar__handle-actions" contenteditable="false">
        <button type="button" data-toolbar-action="close" contenteditable="false">é–‰ã˜ã‚‹</button>
        <button type="button" data-toolbar-action="undo" contenteditable="false">å…ƒã«æˆ»ã™</button>
        <button type="button" data-toolbar-action="complete" contenteditable="false">å®Œäº†</button>
        <button type="button" data-toolbar-action="refresh" contenteditable="false">æ›´æ–°</button>
      </div>
    </div>
    <select id="insert-position" aria-label="æŒ¿å…¥ä½ç½®">
      <option value="cursor">ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®</option>
      <option value="before">é¸æŠãƒ‘ãƒ¼ãƒ„ã®å‰</option>
      <option value="after">é¸æŠãƒ‘ãƒ¼ãƒ„ã®å¾Œ</option>
      <option value="start">æ–‡é ­</option>
      <option value="end">æ–‡æœ«</option>
    </select>
    <button type="button" id="image-upload-trigger">ç”»åƒã‚’æŒ¿å…¥</button>
    <input type="file" id="image-upload" accept="image/*" aria-label="ç”»åƒã‚’æŒ¿å…¥" />
    <div class="size-control">
      <input type="range" id="image-size-range" min="30" max="100" value="100" aria-label="ç”»åƒã‚µã‚¤ã‚º" />
      <input type="number" id="image-size-input" min="30" max="100" value="100" aria-label="ç”»åƒã‚µã‚¤ã‚º" />%
    </div>
    <button type="button" id="delete-part">é¸æŠãƒ‘ãƒ¼ãƒ„å‰Šé™¤</button>
    <button type="button" data-action="toggle-frame">æ å›²ã„</button>
    <button type="button" data-action="toggle-underline">ä¸‹ç·š</button>
    <input type="color" id="frame-color" value="#38bdf8" title="æ ãƒ»ä¸‹ç·šã®è‰²" />
    <button type="button" data-overlay="square">å››è§’æ </button>
    <button type="button" data-overlay="circle">â—‹æ </button>
    <button type="button" data-overlay="text">æ–‡å­—/çµµæ–‡å­—</button>
    <button type="button" data-icon="pointer">ğŸ‘† æŒ‡ãƒãƒ¼ã‚¯</button>
    <button type="button" data-icon="notice">âš ï¸ æ³¨æ„</button>
    <button type="button" data-icon="comment">ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ</button>
    <button type="button" data-icon="num-1">1</button>
    <button type="button" data-icon="num-2">2</button>
    <button type="button" data-icon="num-3">3</button>
    <button type="button" data-icon="num-4">4</button>
    <button type="button" data-icon="num-5">5</button>
    <button type="button" data-icon="num-6">6</button>
    <button type="button" data-icon="num-7">7</button>
    <button type="button" data-icon="num-8">8</button>
    <button type="button" data-icon="num-9">9</button>
    <button type="button" data-icon="num-10">10</button>
  </div>
  <div class="page-zoom" id="page-zoom">
  <main>
    <div class="draft-banner is-hidden" id="draft-banner" role="status">
      <div class="draft-banner__text">
        <strong>å‰å›ä½œæˆãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã£ã¦ã¾ã™</strong>
        <span class="draft-banner__meta" id="draft-banner-meta"></span>
      </div>
      <div class="draft-banner__actions">
        <button type="button" class="primary" id="draft-restore">å¾©å…ƒã™ã‚‹</button>
        <button type="button" id="draft-discard">ç ´æ£„ã™ã‚‹</button>
      </div>
    </div>
    <div class="editor-shell" id="editor-shell">
      <div class="editor" id="editor" contenteditable="true">
    <section class="panel">
      <h2>ç›®æ¬¡</h2>
      <ol class="toc">
        <li><a href="#sec-1">EnChoã§ã§ãã‚‹ã“ã¨</a></li>
        <li><a href="#sec-2">ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•</a></li>
        <li><a href="#sec-3">CoDMONã‹ã‚‰CSVãƒ‡ãƒ¼ã‚¿ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a></li>
        <li><a href="#sec-4">EnChoã¸ã®CSVãƒ‡ãƒ¼ã‚¿ã®å–è¾¼ã¿</a></li>
        <li><a href="#sec-5">EnChoã§ã®ç™»åœ’/é™åœ’ãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†</a></li>
        <li><a href="#sec-6">ä¿è­·è€…ã¸ã®å»¶é•·/é ã‚Šä¿è‚²æ˜ç´°ã®ç¢ºèªä¾é ¼</a></li>
        <li><a href="#sec-7">ãƒ‡ãƒ¼ã‚¿ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã«ã¤ã„ã¦</a></li>
        <li><a href="#sec-8">ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆæ–°è¦ç™»éŒ²ã€ç·¨é›†å…¥åŠ›ã€è¡Œå‰Šé™¤å¯èƒ½ã¨ã™ã‚‹ï¼‰</a></li>
      </ol>
    </section>

    <section id="sec-1" class="panel">
      <h2>1. EnChoã§ã§ãã‚‹ã“ã¨</h2>
      <ul>
        <li>å»¶é•·/é ã‚Šä¿è‚²ã®æ–™é‡‘è¨ˆç®—ã¨è«‹æ±‚ç”¨ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ</li>
        <li>ç™»åœ’/é™åœ’æ‰“åˆ»ã®ä¿®æ­£ã¨åŒºåˆ†ï¼ˆæ¨™æº–æ™‚é–“ãƒ»çŸ­æ™‚é–“ãƒ»1å·èªå®šï¼‰ã®ç®¡ç†</li>
        <li>ä¿è­·è€…ã¸ã®æœˆæ¬¡æ˜ç´°ã®é€šçŸ¥ã€ç¢ºèªä¾é ¼ã€ã‚³ãƒ¡ãƒ³ãƒˆé€£çµ¡</li>
        <li>CoDMONé€£æºãƒ‡ãƒ¼ã‚¿ã®å–è¾¼ã¿ãƒ»å‡ºåŠ›</li>
        <li>ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ç®¡ç†ã¨å¤‰æ›´è¨˜éŒ²</li>
      </ul>
    </section>

    <section id="sec-2" class="panel">
      <h2>2. ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•</h2>
      <ol class="steps">
        <li>EnChoã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€åœ’ã®å…ˆç”Ÿç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
        <li>äºŒæ®µéšèªè¨¼ãŒã‚ã‚‹å ´åˆã¯ã€é€šçŸ¥ã•ã‚ŒãŸèªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
        <li>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚ŒãŸå½“æœˆãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã€ä½œæ¥­ã‚’é–‹å§‹ã—ã¾ã™ã€‚</li>
      </ol>
      <div class="note">åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ã€æ¨©é™ã«å¿œã˜ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¾ã™ã€‚</div>
    </section>

    <section id="sec-3" class="panel">
      <h2>3. CoDMONã‹ã‚‰CSVãƒ‡ãƒ¼ã‚¿ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h2>
      <ol class="steps">
        <li>CoDMONã®ã€Œå‡ºæ¬ ãƒ»ç™»é™åœ’ã€ç”»é¢ã§å¯¾è±¡æœˆã‚’é¸æŠã—ã¾ã™ã€‚</li>
        <li>ã€ŒCSVå‡ºåŠ›ã€ã‹ã‚‰ç™»åœ’/é™åœ’è¨˜éŒ²ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</li>
        <li>ãƒ•ã‚¡ã‚¤ãƒ«åã¯ã€Œåœ’å_å¹´æœˆ_ç™»é™åœ’.csvã€ãªã©åˆ†ã‹ã‚Šã‚„ã™ãä¿å­˜ã—ã¾ã™ã€‚</li>
      </ol>
    </section>

    <section id="sec-4" class="panel">
      <h2>4. EnChoã¸ã®CSVãƒ‡ãƒ¼ã‚¿ã®å–è¾¼ã¿</h2>
      <ol class="steps">
        <li>EnChoã®ã€Œãƒ‡ãƒ¼ã‚¿å–è¾¼ã¿ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ãã¾ã™ã€‚</li>
        <li>å…ˆã»ã©ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸCSVã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã™ã€‚</li>
        <li>å–è¾¼ã¿çµæœã®ã‚µãƒãƒªãƒ¼ã‚’ç¢ºèªã—ã€ä¸æ•´åˆãŒã‚ã‚‹å ´åˆã¯è­¦å‘Šã‚’ç¢ºèªã—ã¾ã™ã€‚</li>
      </ol>
      <div class="note">è­¦å‘ŠãŒå‡ºãŸå ´åˆã¯ã€CSVã®æ¬ æè¡Œã‚„é‡è¤‡è¡Œã‚’ç¢ºèªã—å†å–è¾¼ã¿ã—ã¾ã™ã€‚</div>
    </section>

    <section id="sec-5" class="panel">
      <h2>5. EnChoã§ã®ç™»åœ’/é™åœ’ãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†</h2>
      <h3>ï¼ˆ1ï¼‰ç™»åœ’/é™åœ’æ‰“åˆ»æ™‚é–“ã®ä¿®æ­£</h3>
      <ul>
        <li>è©²å½“åœ’å…ã®è¡Œã‚’é¸æŠã—ã€ä¿®æ­£ã—ãŸã„æ—¥ä»˜ã®æ‰“åˆ»æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
        <li>ä¿å­˜å¾Œã€å†è¨ˆç®—ã‚’å®Ÿè¡Œã—ã¦æ–™é‡‘ã¸ã®åæ˜ ã‚’ç¢ºèªã—ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ2ï¼‰åŒºåˆ†å¤‰æ›´ï¼ˆæ¨™æº–æ™‚é–“ã€çŸ­æ™‚é–“ã€1å·èªå®šï¼‰</h3>
      <ul>
        <li>åœ’å…è©³ç´°ã‹ã‚‰åŒºåˆ†ã‚’é¸æŠã—å¤‰æ›´ã—ã¾ã™ã€‚</li>
        <li>åŒºåˆ†å¤‰æ›´ã¯ãã®æœˆã®å…¨æ—¥ç¨‹ã«é©ç”¨ã•ã‚Œã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚</li>
      </ul>
      <h4>åŒºåˆ†å¤‰æ›´è¡¨ç¤ºã®é‡‘é¡é›†è¨ˆãƒ»å‚™è€ƒï¼ˆåˆ©ç”¨æ—¥é‡‘é¡æ˜ç´°ï¼‰ã®æ›¸å¼</h4>
      <p>åŒºåˆ†å¤‰æ›´è¡¨ç¤ºã®å„åœ’å…ã®é‡‘é¡é›†è¨ˆã€å‚™è€ƒï¼ˆåˆ©ç”¨æ—¥é‡‘é¡æ˜ç´°è¡¨ç¤ºï¼‰ã¯ã€ä»¥ä¸‹ã®æ›¸å¼ã§è¡¨ç¤ºãƒ»ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚</p>
      <div class="format-block">â–ªï¸å»¶é•·ä¿è‚²ï¼ˆæ¨™æº–æ™‚é–“ï¼‰ã€€ï¼Šå††ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰
å‚™è€ƒæ¬„ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰ï¼š
ã€20**/**/**ã€œ20**/**/**ã€‘æœˆåˆã‚ã€œæœˆæœ«
åˆ©ç”¨æ—¥(æ›œæ—¥)**:**ã€œ**ï¼š**ï¼ˆ\é‡‘é¡ï¼‰
â€»å„åˆ©ç”¨æ—¥ã«ã¤ã„ã¦è¡¨ç¤º</div>
      <div class="format-block">â–ªï¸å»¶é•·ä¿è‚²ï¼ˆã‚¹ãƒãƒƒãƒˆï¼‰â€»çŸ­æ™‚é–“ã€€ï¼Šå††ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰
å‚™è€ƒæ¬„ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰ï¼š
ã€20**/**/**ã€œ20**/**/**ã€‘æœˆåˆã‚ã€œæœˆæœ«
åˆ©ç”¨æ—¥(æ›œæ—¥)**:**ã€œ**ï¼š**ï¼ˆ\é‡‘é¡ï¼‰
â€»å„åˆ©ç”¨æ—¥ã«ã¤ã„ã¦è¡¨ç¤º</div>
      <div class="format-block">â–ªï¸1å·èªå®šï¼ˆæ™‚é–“å»¶é•·ï¼‰ã€€ï¼Šå††ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰
å‚™è€ƒæ¬„ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰ï¼š
ã€20**/**/**ã€œ20**/**/**ã€‘æœˆåˆã‚ã€œæœˆæœ«
åˆ©ç”¨æ—¥(æ›œæ—¥)**:**ã€œ**ï¼š**ï¼ˆ\é‡‘é¡ï¼‰
â€»å„åˆ©ç”¨æ—¥ã«ã¤ã„ã¦è¡¨ç¤º</div>
      <div class="format-block">â–ªï¸1å·èªå®šï¼ˆé ã‚Šä¿è‚²ï¼‰ã€€ï¼Šå††ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰
å‚™è€ƒæ¬„ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰ï¼š
ã€20**/**/**ã€œ20**/**/**ã€‘æœˆåˆã‚ã€œæœˆæœ«
åˆ©ç”¨æ—¥(æ›œæ—¥)**:**ã€œ**ï¼š**ï¼ˆ\é‡‘é¡ï¼‰
â€»å„åˆ©ç”¨æ—¥ã«ã¤ã„ã¦è¡¨ç¤º</div>
      <div class="format-block">â–ªï¸1å·èªå®šï¼ˆãŠã‚„ã¤ä»£ã€æ˜¼é£Ÿä»£ï¼‰ã€€ï¼Šå††ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰
å‚™è€ƒæ¬„ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¯ï¼‰ï¼š
ã€20**/**/**ã€œ20**/**/**ã€‘æœˆåˆã‚ã€œæœˆæœ«
åˆ©ç”¨æ—¥(æ›œæ—¥)**:**ã€œ**ï¼š**ï¼ˆ\é‡‘é¡ï¼‰
â€»å„åˆ©ç”¨æ—¥ã«ã¤ã„ã¦è¡¨ç¤º</div>

      <h3>ï¼ˆ3ï¼‰è¤‡æ•°ã®åœ’å…ã®åŒºåˆ†å¤‰æ›´ï¼ˆä¸€æ‹¬ï¼‰</h3>
      <ul>
        <li>ä¸€è¦§ç”»é¢ã§è¤‡æ•°åœ’å…ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã€ã€Œä¸€æ‹¬å¤‰æ›´ã€ã‚’é¸æŠã—ã¾ã™ã€‚</li>
        <li>å¯¾è±¡åŒºåˆ†ã¨é©ç”¨ç¯„å›²ï¼ˆæ—¥ä»˜ã¾ãŸã¯æœˆæ¬¡ï¼‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ4ï¼‰é•·æœŸä¼‘æš‡æœŸé–“ã®é ã‚Šä¿è‚²ï¼ˆèªå®šã“ã©ã‚‚åœ’ï¼‰</h3>
      <ul>
        <li>é•·æœŸä¼‘æš‡æœŸé–“ã‚’è¨­å®šã—ã€è©²å½“æ—¥ç¨‹ã®é ã‚Šä¿è‚²ãƒ•ãƒ©ã‚°ã‚’ONã«ã—ã¾ã™ã€‚</li>
        <li>1å·èªå®šã®è¿½åŠ æ–™é‡‘ãƒ«ãƒ¼ãƒ«ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ5ï¼‰CoDMONã®è«‹æ±‚ç®¡ç†ã¸ã®ãƒ‡ãƒ¼ã‚¿è²¼ä»˜ã‘</h3>
      <ul>
        <li>EnChoã‹ã‚‰è«‹æ±‚ç”¨CSVã‚’å‡ºåŠ›ã—ã¾ã™ã€‚</li>
        <li>CoDMONã®è«‹æ±‚ç®¡ç†ç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€CSVè²¼ä»˜ã‘æ©Ÿèƒ½ã§å–è¾¼ã¿ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ6ï¼‰å»¶é•·ä¿è‚²æ–™ã®å…é™¤ï¼ˆé›»è»Šé…å»¶ã€ãƒã‚¹é…å»¶ã€å¤©æ°—ãªã©ï¼‰</h3>
      <ul>
        <li>å…é™¤å¯¾è±¡ã®åœ’å…ãƒ»æ—¥ä»˜ã‚’é¸æŠã—ã€ç†ç”±ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚</li>
        <li>è¨ˆç®—çµæœã®ã€Œå…é™¤ã€æ¬„ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚</li>
      </ul>
    </section>

    <section id="sec-6" class="panel">
      <h2>6. ä¿è­·è€…ã¸ã®å»¶é•·/é ã‚Šä¿è‚²æ˜ç´°ã®ç¢ºèªä¾é ¼</h2>
      <h3>ï¼ˆ1ï¼‰åœ’å…ç´ä»˜ã‘ï¼ˆQRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºãƒ»å°åˆ·ï¼‰</h3>
      <ul>
        <li>EnChoã®ã€Œä¿è­·è€…é€£æºã€ã‹ã‚‰åœ’å…ã”ã¨ã®QRã‚³ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã—ã¾ã™ã€‚</li>
        <li>QRã‚³ãƒ¼ãƒ‰ã‚’å°åˆ·ã—ã€ä¿è­·è€…ã¸é…å¸ƒã—ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ2ï¼‰æœˆæ¬¡æ˜ç´°é€šçŸ¥ãƒ»ç¢ºèªä¾é ¼ï¼ˆWebãƒ–ãƒ©ã‚¦ã‚¶ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼‰</h3>
      <ul>
        <li>æœˆæœ«ã«ã€Œæ˜ç´°é€šçŸ¥ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ä¸€æ–‰é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã™ã€‚</li>
        <li>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¢ºèªãŒå¿…è¦ãªå ´åˆã¯ã€å°åˆ·ç‰ˆã®æ˜ç´°æ›¸ã‚’é…å¸ƒã—ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ3ï¼‰ãã®ä»–é€£çµ¡ï¼ˆå»¶é•·æ™‚é–“ç¢ºèª/ã‚³ãƒ¡ãƒ³ãƒˆè¿”ã—ã€è¿”é‡‘/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆé ã‚Šä¿è‚²ï¼‰ï¼‰</h3>
      <ul>
        <li>ä¿è­·è€…ã‹ã‚‰ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã‚¿ãƒ–ã§ç¢ºèªã—ã¾ã™ã€‚</li>
        <li>è¿”é‡‘ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯æœˆæ¬¡å‡¦ç†å‰ã«åæ˜ ã—ã€å±¥æ­´ã‚’æ®‹ã—ã¾ã™ã€‚</li>
      </ul>
    </section>

    <section id="sec-7" class="panel">
      <h2>7. ãƒ‡ãƒ¼ã‚¿ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã«ã¤ã„ã¦</h2>
      <h3>ï¼ˆ1ï¼‰ãƒ­ã‚°ã‚¤ãƒ³ç®¡ç†ï¼ˆåœ’å…ˆç”Ÿï¼‰</h3>
      <ul>
        <li>åœ’ã”ã¨ã«å°‚ç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç™ºè¡Œã—ã€æ¨©é™ã‚’æœ€å°åŒ–ã—ã¾ã™ã€‚</li>
        <li>å®šæœŸçš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã¨ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã®ç›£æŸ»ã‚’è¡Œã„ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ2ï¼‰ãƒ‡ãƒ¼ã‚¿ä¿å­˜å ´æ‰€ï¼ˆè¨ˆç®—ã€é€šçŸ¥ã€ãƒ­ã‚°ã€å‡ºåŠ›çµæœï¼‰</h3>
      <ul>
        <li>è¨ˆç®—çµæœã‚„é€šçŸ¥å±¥æ­´ã¯æš—å·åŒ–ã•ã‚ŒãŸã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã—ã¾ã™ã€‚</li>
        <li>å‡ºåŠ›çµæœã¯åœ’ã”ã¨ã«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚’è¨­å®šã—ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ3ï¼‰é€šä¿¡çµŒè·¯</h3>
      <ul>
        <li>CSVã‚’ç”¨ã„ãŸè¨ˆç®—ã€ä¿è­·è€…ã®ç™»éŒ²ã€ç™»éŒ²ç”¨QRã‚³ãƒ¼ãƒ‰ã€è¨ˆç®—çµæœå‡ºåŠ›ã€ä¿è­·è€…é€šçŸ¥ã€ä¿è­·è€…è¿”ä¿¡ã¯ã™ã¹ã¦HTTPSé€šä¿¡ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</li>
        <li>é€šä¿¡ãƒ­ã‚°ã¯ç•°å¸¸æ¤œçŸ¥ã®ãŸã‚ã«ä¿å­˜ã—ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ4ï¼‰ãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«</h3>
      <ul>
        <li>åœ’å…æƒ…å ±ï¼ˆåœ’åã€ã‚¯ãƒ©ã‚¹åã€åœ’å…åï¼‰</li>
        <li>ç™»éŒ²è€…æƒ…å ±ï¼ˆåœ’å…ç´ä»˜ã‘ç™»éŒ²è€…ãŒåœ’å…ã®ä¿è­·è€…ã§ã‚ã‚‹ã“ã¨ã‚’è¨¼æ˜ã™ã‚‹å†…å®¹ï¼šç”Ÿä½“èªè­˜æƒ…å ±ã¯å«ã¿ã¾ã›ã‚“ï¼‰</li>
        <li>ç™»éŒ²ç«¯æœ«æƒ…å ±ï¼ˆç«¯æœ«OSã€æ¥ç¶šIPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰</li>
        <li>å»¶é•·/é ã‚Šä¿è‚²æ–™è¨ˆç®—ã«å¿…è¦ãªæƒ…å ±ãŠã‚ˆã³è¨ˆç®—åŸºç¤å€¤</li>
        <li>å¸‚å†…ä¿è‚²æ‰€æ¨™æº–æ™‚é–“ã€çŸ­æ™‚é–“ä¸¦ã³ã«å»¶é•·/èªå®šã“ã©ã‚‚åœ’ã«ãŠã‘ã‚‹1å·èªå®šåŠã³é ã‚Šä¿è‚²æ–™é‡‘è¨ˆç®—ã«å¿…è¦ãªæƒ…å ±</li>
      </ul>
    </section>

    <section id="sec-8" class="panel">
      <h2>8. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆæ–°è¦ç™»éŒ²ã€ç·¨é›†å…¥åŠ›ã€è¡Œå‰Šé™¤å¯èƒ½ã¨ã™ã‚‹ï¼‰</h2>
      <h3>ï¼ˆ1ï¼‰è¨ˆç®—åŸºç¤å€¤ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå¤‰æ›´å…¥åŠ›å€¤ç™»éŒ²å…¥åŠ›ãƒãƒ¼ï¼‰</h3>
      <ul>
        <li>å¤‰æ›´å†…å®¹ã‚’å…¥åŠ›ãƒãƒ¼ã«è¨˜éŒ²ã—ã€ä¿å­˜æ™‚ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’ä»˜ä¸ã—ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ2ï¼‰æ›´æ–°å±¥æ­´ï¼ˆãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒãƒ¼ï¼‰</h3>
      <ul>
        <li>æ›´æ–°ç†ç”±ã€å¯¾å¿œè€…ã€å¯¾è±¡æœˆã‚’å±¥æ­´æ¬„ã«è¨˜éŒ²ã—ã¾ã™ã€‚</li>
      </ul>

      <h3>ï¼ˆ3ï¼‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰æ›´æ–¹æ³•</h3>
      <ul>
        <li>å¯¾è±¡ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é¸æŠã—ã€å¤‰æ›´å¾Œã®å€¤ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
        <li>å½±éŸ¿ç¯„å›²ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ç¢ºèªã—ã€é©ç”¨ã—ã¾ã™ã€‚</li>
      </ul>
    </section>
      </div>
    </div>
  </main>
  <footer class="page-footer">
    <div class="page-footer__inner" aria-live="polite">
      <div class="page-footer__status">
        <span>MODE: <strong id="mode-label">CLOUD</strong></span>
        <span>version: <strong id="mode-version-label">--</strong></span>
        <span class="page-footer__note" id="mode-status-note"></span>
        <span>æ›´æ–°: <strong id="latest-info">--</strong></span>
      </div>
    </div>
  </footer>
  </div>
  <div class="toast" id="toast" role="status" aria-live="polite"></div>
  <script src="session.js"></script>
  <script>
    const editor = document.getElementById("editor");
    const pageHeader = document.querySelector(".page-header");
    const pageZoom = document.getElementById("page-zoom");
    const editorToolbar = document.getElementById("editorToolbar");
    const editorShell = document.getElementById("editor-shell");
    const editorBackdrop = document.getElementById("editor-backdrop");
    const editorToolbarHandle = document.getElementById("editor-toolbar-handle");
    const toggleEditorToolsBtn = document.getElementById("toggle-editor-tools");
    const confirmContentBtn = document.getElementById("confirm-content");
    const refreshContentBtn = document.getElementById("refresh-content");
    const zoomControl = document.getElementById("zoom-control");
    const zoomLabel = document.getElementById("zoom-label");
    const zoomDecreaseBtn = document.getElementById("zoom-decrease");
    const zoomIncreaseBtn = document.getElementById("zoom-increase");
    const imageUpload = document.getElementById("image-upload");
    const imageUploadTrigger = document.getElementById("image-upload-trigger");
    const frameColor = document.getElementById("frame-color");
    const insertPosition = document.getElementById("insert-position");
    const imageSizeRange = document.getElementById("image-size-range");
    const imageSizeInput = document.getElementById("image-size-input");
    const deletePartBtn = document.getElementById("delete-part");
    const versionLabelEl = document.getElementById("version-label");
    const latestInfoEl = document.getElementById("latest-info");
    const modeLabelEl = document.getElementById("mode-label");
    const modeVersionLabelEl = document.getElementById("mode-version-label");
    const modeStatusNoteEl = document.getElementById("mode-status-note");
    const draftBanner = document.getElementById("draft-banner");
    const draftBannerMeta = document.getElementById("draft-banner-meta");
    const draftRestoreBtn = document.getElementById("draft-restore");
    const draftDiscardBtn = document.getElementById("draft-discard");
    const toast = document.getElementById("toast");
    let selectedPart = null;
    let draggingOverlay = null;
    let dragOffsetX = 0;
    let dragOffsetY = 0;
    let latestVersion = null;
    let isEditLocked = false;
    let draftSaveTimer = null;
    let toolbarDragging = false;
    let toolbarDragOffsetX = 0;
    let toolbarDragOffsetY = 0;
    let toolbarLocked = true;
    let refreshLabelTimer = null;
    const ZOOM_KEY = "encho_usage_zoom_v1";
    const MODE = window.__MODE__ || window.MODE || "CLOUD"; // "LOCAL" | "CLOUD"
    const BASE_URL = MODE === "LOCAL" ? "https://mac-gate.local" : "";
    const buildApiUrl = (path) => (MODE === "LOCAL" ? `${BASE_URL}${path}` : path);
    const LAST_KNOWN_KEY = "encho_latest_last_known_v1";
    const apiFetch = (path, options = {}) => fetch(buildApiUrl(path), { cache: "no-store", ...options });
    const fetchWithTimeout = (url, options = {}, timeoutMs = 12000) => {
      const controller = new AbortController();
      const timeoutId = window.setTimeout(() => controller.abort(), timeoutMs);
      return fetch(url, { ...options, signal: controller.signal })
        .finally(() => {
          window.clearTimeout(timeoutId);
        });
    };

    const getCurrentUser = () => {
      if (typeof window.getActiveUser === "function") {
        return window.getActiveUser() || "guest";
      }
      return "guest";
    };
    const CURRENT_USER = getCurrentUser();
    const DRAFT_KEY = `encho_usage_draft::${CURRENT_USER}`;
    const DRAFT_META_KEY = `encho_usage_draft_meta::${CURRENT_USER}`;

    const showToast = (message) => {
      if (!toast) return;
      toast.textContent = message;
      toast.classList.add("is-visible");
      window.clearTimeout(showToast._timer);
      showToast._timer = window.setTimeout(() => {
        toast.classList.remove("is-visible");
      }, 2400);
    };

    const formatDate = (value, withTime = false) => {
      if (!value) return "";
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) return value;
      const options = withTime
        ? { year: "numeric", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit" }
        : { year: "numeric", month: "2-digit", day: "2-digit" };
      return date.toLocaleString("ja-JP", options).replace(/\//g, "-");
    };

    const updateModeStatus = (data, offline = false) => {
      if (modeLabelEl) modeLabelEl.textContent = MODE;
      if (modeVersionLabelEl) {
        modeVersionLabelEl.textContent = data?.version_label || (offline ? "ã‚ªãƒ•ãƒ©ã‚¤ãƒ³/å–å¾—å¤±æ•—" : "--");
      }
    };

    const updateHeaderMeta = (data) => {
      if (!data) return;
      const versionLabel = data.version_label || "--";
      versionLabelEl.textContent = versionLabel;
      if (modeVersionLabelEl) modeVersionLabelEl.textContent = versionLabel;
      const updatedBy = data.updated_by || "ä¸æ˜";
      const updatedAt = formatDate(data.updated_at, true);
      latestInfoEl.textContent = `${updatedBy} / ${updatedAt || "--"}`;
    };

    const setModeStatus = (note) => {
      if (modeLabelEl) modeLabelEl.textContent = MODE;
      if (modeStatusNoteEl) modeStatusNoteEl.textContent = note || "";
    };

    const loadLastKnown = () => {
      try {
        return JSON.parse(localStorage.getItem(LAST_KNOWN_KEY));
      } catch (error) {
        return null;
      }
    };

    const saveLastKnown = (data) => {
      if (!data) return;
      try {
        localStorage.setItem(LAST_KNOWN_KEY, JSON.stringify(data));
      } catch (error) {
        console.error("last_known ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ", error);
      }
    };

    const setEditLocked = (locked) => {
      isEditLocked = locked;
      editor.setAttribute("contenteditable", String(!locked));
      confirmContentBtn.classList.toggle("is-locked", locked);
      confirmContentBtn.textContent = locked ? "ç¢ºå®šæ¸ˆã¿" : "ç¢ºå®š";
      if (locked) {
        setToolbarVisibility(false);
      }
    };

    const loadDraft = () => {
      let content = localStorage.getItem(DRAFT_KEY);
      let meta = null;
      try {
        meta = JSON.parse(localStorage.getItem(DRAFT_META_KEY));
      } catch (error) {
        meta = null;
      }
      if (!content && meta?.content_html) {
        content = meta.content_html;
      }
      if (!content) return null;
      return {
        content_html: content,
        saved_at: meta?.saved_at,
        base_version_id: meta?.base_version_id,
        base_version_label: meta?.base_version_label
      };
    };

    const saveDraft = () => {
      if (isEditLocked) return;
      const content = editor.innerHTML;
      const meta = {
        content_html: content,
        saved_at: new Date().toISOString(),
        base_version_id: latestVersion?.id || null,
        base_version_label: latestVersion?.version_label || null
      };
      try {
        localStorage.setItem(DRAFT_KEY, content);
        localStorage.setItem(DRAFT_META_KEY, JSON.stringify(meta));
      } catch (error) {
        console.error("ãƒ‰ãƒ©ãƒ•ãƒˆä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ", error);
      }
    };

    const clearDraft = () => {
      localStorage.removeItem(DRAFT_KEY);
      localStorage.removeItem(DRAFT_META_KEY);
    };

    const showDraftBanner = (draft) => {
      if (!draftBanner) return;
      if (!draft) {
        draftBanner.classList.add("is-hidden");
        return;
      }
      draftBanner.classList.remove("is-hidden");
      const savedAt = formatDate(draft.saved_at, true);
      const baseLabel = draft.base_version_label ? ` / å‚ç…§:${draft.base_version_label}` : "";
      draftBannerMeta.textContent = savedAt ? `ä¿å­˜æ—¥æ™‚: ${savedAt}${baseLabel}` : baseLabel;
    };

    const debounceDraftSave = () => {
      if (draftSaveTimer) window.clearTimeout(draftSaveTimer);
      draftSaveTimer = window.setTimeout(() => {
        saveDraft();
      }, 800);
    };

    const loadLatest = async ({ clearDraftOnSuccess = false } = {}) => {
      updateModeStatus(latestVersion);
      try {
        const response = await apiFetch("/encho-usage/latest");
        if (!response.ok) throw new Error("latest fetch failed");
        const data = await response.json();
        latestVersion = data;
        if (data?.content_html) {
          editor.innerHTML = data.content_html;
        }
        updateHeaderMeta(data);
        saveLastKnown(data);
        if (clearDraftOnSuccess) {
          clearDraft();
          showDraftBanner(null);
        }
        setModeStatus("");
      } catch (error) {
        console.error("æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ", error);
        const fallback = loadLastKnown();
        if (fallback) {
          latestVersion = fallback;
          if (fallback?.content_html) {
            editor.innerHTML = fallback.content_html;
          }
          updateHeaderMeta(fallback);
        }
        setModeStatus("ã‚ªãƒ•ãƒ©ã‚¤ãƒ³/å–å¾—å¤±æ•—");
        showToast("æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    };

    const saveLatest = async () => {
      const payload = {
        content_html: editor.innerHTML,
        updated_by: CURRENT_USER
      };
      const saveLocalSnapshot = () => {
        const localData = {
          id: `local-${Date.now()}`,
          version_label: "ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜",
          updated_by: CURRENT_USER,
          updated_at: new Date().toISOString(),
          content_html: payload.content_html
        };
        latestVersion = localData;
        updateHeaderMeta(localData);
        saveLastKnown(localData);
        clearDraft();
        showDraftBanner(null);
        setModeStatus("ã‚ªãƒ•ãƒ©ã‚¤ãƒ³/ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜");
        showToast("ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã®ãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ");
        setEditLocked(true);
      };
      try {
        const response = await fetchWithTimeout(buildApiUrl("/admin/encho-usage/save"), {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        if (!response.ok) {
          throw new Error("save failed");
        }
        const data = await response.json();
        latestVersion = data;
        updateHeaderMeta(data);
        clearDraft();
        showDraftBanner(null);
        showToast("ä¿å­˜ã—ã¾ã—ãŸ");
        setEditLocked(true);
      } catch (error) {
        console.error("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ", error);
        try {
          saveLocalSnapshot();
        } catch (localError) {
          console.error("ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ", localError);
          throw error;
        }
      }
    };

    const insertAtCursor = (html) => {
      editor.focus();
      const selection = window.getSelection();
      if (!selection || selection.rangeCount === 0) {
        editor.insertAdjacentHTML("beforeend", html);
        return;
      }
      const range = selection.getRangeAt(0);
      range.deleteContents();
      const temp = document.createElement("div");
      temp.innerHTML = html;
      const frag = document.createDocumentFragment();
      let node;
      while ((node = temp.firstChild)) {
        frag.appendChild(node);
      }
      range.insertNode(frag);
      range.collapse(false);
      selection.removeAllRanges();
      selection.addRange(range);
    };

    const insertContent = (html) => {
      editor.focus();
      const mode = insertPosition.value;
      if (mode === "start") {
        editor.insertAdjacentHTML("afterbegin", html);
        return;
      }
      if (mode === "end") {
        editor.insertAdjacentHTML("beforeend", html);
        return;
      }
      if ((mode === "before" || mode === "after") && selectedPart) {
        selectedPart.insertAdjacentHTML(mode === "before" ? "beforebegin" : "afterend", html);
        return;
      }
      insertAtCursor(html);
    };

    const blobToDataUrl = (blob) => new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.readAsDataURL(blob);
    });

    const loadImage = (file) => new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = reader.result;
      };
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });

    const compressImage = async (file, targetBytes = 300 * 1024) => {
      const img = await loadImage(file);
      const maxDimension = 1600;
      let width = img.width;
      let height = img.height;
      if (width > maxDimension || height > maxDimension) {
        const scale = Math.min(maxDimension / width, maxDimension / height);
        width = Math.round(width * scale);
        height = Math.round(height * scale);
      }

      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = width;
      canvas.height = height;
      ctx.drawImage(img, 0, 0, width, height);

      let quality = 0.9;
      let blob = await new Promise((resolve) => canvas.toBlob(resolve, "image/jpeg", quality));
      while (blob && blob.size > targetBytes && quality > 0.5) {
        quality -= 0.07;
        blob = await new Promise((resolve) => canvas.toBlob(resolve, "image/jpeg", quality));
      }

      if (blob && blob.size > targetBytes) {
        const scale = Math.sqrt(targetBytes / blob.size);
        if (scale < 0.98) {
          width = Math.max(300, Math.round(width * scale));
          height = Math.max(300, Math.round(height * scale));
          canvas.width = width;
          canvas.height = height;
          ctx.drawImage(img, 0, 0, width, height);
          quality = 0.85;
          blob = await new Promise((resolve) => canvas.toBlob(resolve, "image/jpeg", quality));
        }
      }

      return blob ? blobToDataUrl(blob) : "";
    };

    const setToolbarVisibility = (isVisible) => {
      if (!editorToolbar || !toggleEditorToolsBtn) return;
      editorToolbar.classList.toggle("is-hidden", !isVisible);
      toggleEditorToolsBtn.classList.toggle("is-active", isVisible);
      toggleEditorToolsBtn.setAttribute("aria-expanded", String(isVisible));
      editorToolbar.setAttribute("aria-hidden", String(!isVisible));
    };

    const updateHeaderHeight = () => {
      if (!pageHeader) return;
      const height = pageHeader.getBoundingClientRect().height;
      document.documentElement.style.setProperty("--page-header-height", `${height}px`);
    };

    const applyZoom = (value) => {
      const normalized = Math.min(130, Math.max(80, Number(value) || 100));
      const scale = normalized / 100;
      if (pageZoom) {
        pageZoom.style.setProperty("--page-zoom", scale);
      }
      if (zoomLabel) zoomLabel.textContent = `${normalized}%`;
      if (zoomControl) zoomControl.value = String(normalized);
      localStorage.setItem(ZOOM_KEY, String(normalized));
    };

    const setEditorLock = (isLocked) => {
      if (!editorShell || !editorBackdrop) return;
      editorShell.classList.toggle("is-locked", isLocked);
      editorBackdrop.classList.toggle("is-visible", isLocked);
      document.body.classList.toggle("is-editor-locked", isLocked);
    };

    const updateToolbarLockState = () => {
      if (!editorToolbar) return;
      editorToolbar.classList.toggle("is-locked", toolbarLocked);
    };

    updateHeaderHeight();
    window.addEventListener("resize", updateHeaderHeight);

    if (zoomControl) {
      const storedZoom = Number(localStorage.getItem(ZOOM_KEY)) || 100;
      applyZoom(storedZoom);
      zoomControl.addEventListener("input", (event) => {
        applyZoom(event.target.value);
      });
    }
    zoomDecreaseBtn?.addEventListener("click", () => {
      const current = Number(zoomControl?.value) || 100;
      applyZoom(current - 5);
    });
    zoomIncreaseBtn?.addEventListener("click", () => {
      const current = Number(zoomControl?.value) || 100;
      applyZoom(current + 5);
    });

    toggleEditorToolsBtn?.addEventListener("click", () => {
      const isHidden = editorToolbar?.classList.contains("is-hidden");
      setToolbarVisibility(isHidden);
      if (isHidden) {
        toolbarLocked = false;
        updateToolbarLockState();
        setEditorLock(true);
      } else {
        setEditorLock(false);
      }
    });

    const setRefreshLabels = (text) => {
      if (refreshContentBtn) refreshContentBtn.textContent = text;
      const toolbarRefreshBtn = editorToolbar?.querySelector('[data-toolbar-action="refresh"]');
      if (toolbarRefreshBtn) toolbarRefreshBtn.textContent = text;
    };

    const handleToolbarAction = (action) => {
      if (!action) return;
      if (action === "close") {
        setToolbarVisibility(false);
        setEditorLock(false);
        setEditLocked(true);
        toolbarLocked = true;
        updateToolbarLockState();
        return;
      }
      if (action === "undo") {
        editor?.focus();
        if (document.queryCommandSupported?.("undo")) {
          document.execCommand("undo");
        }
        return;
      }
      if (action === "complete") {
        confirmContentBtn?.click();
        return;
      }
      if (action === "refresh") {
        refreshContentBtn?.click();
      }
    };

    editorToolbar?.addEventListener("click", (event) => {
      const actionBtn = event.target.closest("[data-toolbar-action]");
      if (!actionBtn) return;
      event.preventDefault();
      event.stopPropagation();
      handleToolbarAction(actionBtn.dataset.toolbarAction);
    });
    editorToolbar?.addEventListener("pointerup", (event) => {
      const actionBtn = event.target.closest("[data-toolbar-action]");
      if (!actionBtn) return;
      event.preventDefault();
      event.stopPropagation();
      handleToolbarAction(actionBtn.dataset.toolbarAction);
    });
    editorToolbar?.addEventListener("beforeinput", (event) => {
      if (event.target.closest("input, select, textarea, button")) return;
      event.preventDefault();
    });

    editorToolbarHandle?.addEventListener("pointerdown", (event) => {
      if (!editorToolbar || toolbarLocked) return;
      if (event.target.closest("[data-toolbar-action]")) return;
      toolbarDragging = true;
      const rect = editorToolbar.getBoundingClientRect();
      toolbarDragOffsetX = event.clientX - rect.left;
      toolbarDragOffsetY = event.clientY - rect.top;
      editorToolbar.style.right = "auto";
      editorToolbar.style.bottom = "auto";
      editorToolbar.style.left = `${rect.left}px`;
      editorToolbar.style.top = `${rect.top}px`;
      editorToolbarHandle.setPointerCapture(event.pointerId);
    });

    window.addEventListener("pointermove", (event) => {
      if (!toolbarDragging || !editorToolbar) return;
      const maxLeft = window.innerWidth - editorToolbar.offsetWidth;
      const maxTop = window.innerHeight - editorToolbar.offsetHeight;
      const nextLeft = Math.max(8, Math.min(maxLeft - 8, event.clientX - toolbarDragOffsetX));
      const nextTop = Math.max(8, Math.min(maxTop - 8, event.clientY - toolbarDragOffsetY));
      editorToolbar.style.left = `${nextLeft}px`;
      editorToolbar.style.top = `${nextTop}px`;
    });

    window.addEventListener("pointerup", (event) => {
      if (!toolbarDragging || !editorToolbarHandle) return;
      toolbarDragging = false;
      editorToolbarHandle.releasePointerCapture(event.pointerId);
    });

    updateToolbarLockState();

    imageUpload.addEventListener("change", async (event) => {
      const file = event.target.files[0];
      if (!file) return;
      const dataUrl = await compressImage(file);
      if (!dataUrl) return;
      const html = `
        <div class="image-block" style="--frame-color: ${frameColor.value}; --image-width: 100%;">
          <img src="${dataUrl}" alt="æŒ¿å…¥ç”»åƒ" />
          <div class="image-overlay-layer"></div>
        </div>`;
      insertContent(html);
      imageUpload.value = "";
    });
    imageUploadTrigger?.addEventListener("click", () => {
      imageUpload?.click();
    });

    const ensureOverlayLayer = (imageBlock) => {
      if (!imageBlock) return null;
      let layer = imageBlock.querySelector(".image-overlay-layer");
      if (!layer) {
        layer = document.createElement("div");
        layer.className = "image-overlay-layer";
        imageBlock.appendChild(layer);
      }
      return layer;
    };

    const getActiveImageBlock = () => {
      if (selectedPart?.classList.contains("image-block")) {
        return selectedPart;
      }
      if (selectedPart?.classList.contains("image-overlay-item")) {
        return selectedPart.closest(".image-block");
      }
      return null;
    };

    const clearSelection = () => {
      if (!selectedPart) return;
      if (selectedPart.classList.contains("image-block") || selectedPart.classList.contains("image-overlay-item")) {
        selectedPart.classList.remove("selected");
      }
      if (selectedPart.classList.contains("icon-badge") && !selectedPart.classList.contains("image-overlay-item")) {
        selectedPart.classList.remove("selected");
      }
      selectedPart = null;
    };

    const setSelectedPart = (part) => {
      clearSelection();
      selectedPart = part;
      if (selectedPart.classList.contains("image-block") || selectedPart.classList.contains("image-overlay-item")) {
        selectedPart.classList.add("selected");
      }
      if (selectedPart.classList.contains("icon-badge") && !selectedPart.classList.contains("image-overlay-item")) {
        selectedPart.classList.add("selected");
      }
      syncImageSizeControls();
    };

    const syncImageSizeControls = () => {
      if (!selectedPart || !selectedPart.classList.contains("image-block")) {
        imageSizeRange.disabled = true;
        imageSizeInput.disabled = true;
        imageSizeRange.value = 100;
        imageSizeInput.value = 100;
        return;
      }
      const current = Number((selectedPart.style.getPropertyValue("--image-width") || "100%").replace("%", "")) || 100;
      imageSizeRange.disabled = false;
      imageSizeInput.disabled = false;
      imageSizeRange.value = current;
      imageSizeInput.value = current;
    };

    editor.addEventListener("click", (event) => {
      const block = event.target.closest(".image-overlay-item, .image-block, .icon-badge");
      if (block) {
        setSelectedPart(block);
        return;
      }
      clearSelection();
      syncImageSizeControls();
    });

    document.querySelectorAll("[data-action]").forEach((button) => {
      button.addEventListener("click", () => {
        if (!selectedPart || !selectedPart.classList.contains("image-block")) return;
        selectedPart.style.setProperty("--frame-color", frameColor.value);
        if (button.dataset.action === "toggle-frame") {
          selectedPart.classList.toggle("frame");
        }
        if (button.dataset.action === "toggle-underline") {
          selectedPart.classList.toggle("underline");
        }
      });
    });

    const addOverlayItem = (element, fallbackHtml) => {
      const imageBlock = getActiveImageBlock();
      if (!imageBlock) {
        if (fallbackHtml) {
          insertContent(fallbackHtml);
        }
        return;
      }
      const layer = ensureOverlayLayer(imageBlock);
      layer.appendChild(element);
      setSelectedPart(element);
    };

    document.querySelectorAll("[data-icon]").forEach((button) => {
      button.addEventListener("click", () => {
        const icon = button.dataset.icon;
        const badge = document.createElement("span");
        badge.className = "icon-badge image-overlay-item";
        if (icon === "pointer") {
          badge.textContent = "ğŸ‘†";
          addOverlayItem(badge, '<span class="icon-badge">ğŸ‘†</span>');
          return;
        }
        if (icon === "notice") {
          badge.classList.add("notice");
          badge.textContent = "æ³¨æ„";
          addOverlayItem(badge, '<span class="icon-badge notice">æ³¨æ„</span>');
          return;
        }
        if (icon === "comment") {
          badge.classList.add("comment");
          badge.textContent = "ã‚³ãƒ¡ãƒ³ãƒˆ";
          addOverlayItem(badge, '<span class="icon-badge comment">ã‚³ãƒ¡ãƒ³ãƒˆ</span>');
          return;
        }
        if (icon.startsWith("num-")) {
          const number = icon.replace("num-", "");
          badge.textContent = number;
          addOverlayItem(badge, `<span class="icon-badge">${number}</span>`);
        }
      });
    });

    document.querySelectorAll("[data-overlay]").forEach((button) => {
      button.addEventListener("click", () => {
        const imageBlock = getActiveImageBlock();
        if (!imageBlock) return;
        if (button.dataset.overlay === "text") {
          const text = window.prompt("ç”»åƒã«é‡ã­ã‚‹æ–‡å­—ã‚„çµµæ–‡å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", "ãƒ†ã‚­ã‚¹ãƒˆ");
          if (!text) return;
          const label = document.createElement("span");
          label.className = "image-overlay-item image-overlay-text";
          label.textContent = text;
          addOverlayItem(label);
          return;
        }
        const frame = document.createElement("div");
        frame.className = "image-overlay-item frame";
        if (button.dataset.overlay === "circle") {
          frame.classList.add("circle");
        }
        addOverlayItem(frame);
      });
    });

    const applyImageSize = (value) => {
      if (!selectedPart || !selectedPart.classList.contains("image-block")) return;
      const size = Math.min(100, Math.max(30, Number(value) || 100));
      selectedPart.style.setProperty("--image-width", `${size}%`);
      imageSizeRange.value = size;
      imageSizeInput.value = size;
    };

    imageSizeRange.addEventListener("input", (event) => {
      applyImageSize(event.target.value);
    });

    imageSizeInput.addEventListener("change", (event) => {
      applyImageSize(event.target.value);
    });

    deletePartBtn.addEventListener("click", () => {
      if (!selectedPart) return;
      selectedPart.remove();
      selectedPart = null;
      syncImageSizeControls();
    });

    confirmContentBtn?.addEventListener("click", () => {
      if (isEditLocked) {
        setEditLocked(false);
        return;
      }
      confirmContentBtn.disabled = true;
      confirmContentBtn.textContent = "ä¿å­˜ä¸­...";
      saveLatest().catch((error) => {
        console.error("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ", error);
        showToast("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");
        setEditLocked(false);
      }).finally(() => {
        confirmContentBtn.disabled = false;
        if (!isEditLocked) {
          confirmContentBtn.textContent = "ç¢ºå®š";
        }
      });
    });

    refreshContentBtn?.addEventListener("click", async () => {
      refreshContentBtn.disabled = true;
      setRefreshLabels("æ›´æ–°ä¸­...");
      try {
        await loadLatest({ clearDraftOnSuccess: true });
        showToast("æœ€æ–°å†…å®¹ã‚’æ›´æ–°ã—ã¾ã—ãŸ");
        setRefreshLabels("æ›´æ–°ã—ã¾ã—ãŸ");
        window.clearTimeout(refreshLabelTimer);
        refreshLabelTimer = window.setTimeout(() => {
          setRefreshLabels("æ›´æ–°");
          refreshLabelTimer = null;
        }, 2000);
      } catch (error) {
        console.error("æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ", error);
        showToast("æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ");
      } finally {
        refreshContentBtn.disabled = false;
        if (!refreshLabelTimer) {
          setRefreshLabels("æ›´æ–°");
        }
      }
    });

    editor.addEventListener("pointerdown", (event) => {
      const overlay = event.target.closest(".image-overlay-item");
      if (!overlay) return;
      const imageBlock = overlay.closest(".image-block");
      if (!imageBlock) return;
      const rect = overlay.getBoundingClientRect();
      draggingOverlay = overlay;
      dragOffsetX = event.clientX - rect.left;
      dragOffsetY = event.clientY - rect.top;
      overlay.setPointerCapture(event.pointerId);
      setSelectedPart(overlay);
    });

    editor.addEventListener("pointermove", (event) => {
      if (!draggingOverlay) return;
      const imageBlock = draggingOverlay.closest(".image-block");
      if (!imageBlock) return;
      const container = imageBlock.querySelector(".image-overlay-layer");
      if (!container) return;
      const bounds = container.getBoundingClientRect();
      const elementRect = draggingOverlay.getBoundingClientRect();
      const maxLeft = bounds.width - elementRect.width;
      const maxTop = bounds.height - elementRect.height;
      let left = event.clientX - bounds.left - dragOffsetX;
      let top = event.clientY - bounds.top - dragOffsetY;
      left = Math.max(0, Math.min(maxLeft, left));
      top = Math.max(0, Math.min(maxTop, top));
      draggingOverlay.style.left = `${left}px`;
      draggingOverlay.style.top = `${top}px`;
    });

    editor.addEventListener("pointerup", (event) => {
      if (!draggingOverlay) return;
      draggingOverlay.releasePointerCapture(event.pointerId);
      draggingOverlay = null;
    });

    syncImageSizeControls();

    editor.addEventListener("input", () => {
      if (isEditLocked) return;
      debounceDraftSave();
    });

    draftRestoreBtn?.addEventListener("click", () => {
      const draft = loadDraft();
      if (!draft) return;
      editor.innerHTML = draft.content_html;
      showDraftBanner(null);
      setEditLocked(false);
    });

    draftDiscardBtn?.addEventListener("click", () => {
      clearDraft();
      showDraftBanner(null);
      showToast("ãƒ‰ãƒ©ãƒ•ãƒˆã‚’ç ´æ£„ã—ã¾ã—ãŸ");
    });

    const AUTO_DRAFT_SAVE_THROTTLE_MS = 1500;
    let lastAutoDraftSaveAt = 0;
    const runAutoDraftSave = (reason) => {
      const now = Date.now();
      if (now - lastAutoDraftSaveAt < AUTO_DRAFT_SAVE_THROTTLE_MS) return;
      lastAutoDraftSaveAt = now;
      saveDraft();
      if (window.DLOG?.log) {
        window.DLOG.log(`[è‡ªå‹•ä¿å­˜] ${reason}`);
      }
    };

    window.addEventListener("beforeunload", () => {
      runAutoDraftSave("beforeunload");
    });
    window.addEventListener("pagehide", () => {
      runAutoDraftSave("pagehide");
    });
    window.addEventListener("visibilitychange", () => {
      if (document.hidden) {
        runAutoDraftSave("visibilitychange");
      }
    });
    window.addEventListener("freeze", () => {
      runAutoDraftSave("freeze");
    });

    (async () => {
      setModeStatus("");
      await loadLatest();
      const draft = loadDraft();
      if (draft?.content_html) {
        if (latestVersion?.id && draft.base_version_id && draft.base_version_id !== latestVersion.id) {
          clearDraft();
          showToast("æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ ã—ã¾ã—ãŸ");
        } else if (latestVersion?.version_label && draft.base_version_label && draft.base_version_label !== latestVersion.version_label) {
          clearDraft();
          showToast("æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ ã—ã¾ã—ãŸ");
        } else if (draft.content_html === editor.innerHTML) {
          clearDraft();
        } else {
          showDraftBanner(draft);
        }
      }
    })();
  </script>
</body>
</html>
